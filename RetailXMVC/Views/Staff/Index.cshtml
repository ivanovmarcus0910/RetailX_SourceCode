@model IEnumerable<BusinessObject.Models.Staff>

@{
    ViewData["Title"] = "Quản lý Nhân viên";
    Layout = "~/Views/Shared/_OwnerLayout.cshtml";
    
    string GetRoleName(int? role) => role switch
    {
        1 => "Owner",
        2 => "Accountant",
        3 => "Seller",
        4 => "Inventory Manager",
        _ => "Chưa phân quyền"
    };
}

<div class="container-fluid"> <div class="bg-white p-4 rounded shadow-sm">
        
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="mb-0 text-dark fw-bold">Danh sách Nhân viên</h4>
            
            <a asp-action="PendingRequests" class="btn btn-dark rounded-pill px-4">
                <i class="fa fa-user-plus"></i> Duyệt yêu cầu mới
            </a>
        </div>

        <div class="d-flex gap-2 mb-3">
            <input type="text" class="form-control" placeholder="Search staff name..." style="width: 300px;">
            <select class="form-select" style="width: 150px;">
                <option>All Roles</option>
                <option>Seller</option>
                <option>Manager</option>
            </select>
            <button class="btn btn-secondary">Filter</button>
        </div>

        @if(TempData["Success"] != null)
        {
            <div class="alert alert-success mb-3">@TempData["Success"]</div>
        }

        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th class="py-3">Staff Name</th>
                        <th class="py-3">Email</th>
                        <th class="py-3">Role</th>
                        <th class="py-3">Salary</th>
                        <th class="py-3">Status</th>
                        <th class="py-3 text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td class="fw-bold">@item.StaffName</td>
                            <td>@item.Email</td>
                            <td>
                                <span class="badge bg-light text-dark border">@GetRoleName(item.Role)</span>
                            </td>
                            <td>@string.Format("{0:N0} đ", item.BaseSalary)</td>
                            <td>
                                @if(item.IsActive) 
                                { <span class="badge bg-success-subtle text-success px-3 rounded-pill">Active</span> }
                                else 
                                { <span class="badge bg-danger-subtle text-danger px-3 rounded-pill">Inactive</span> }
                            </td>
                            <td class="text-end">
                                @if (item.Role != 1)
                                {
                                    <button onclick="loadEditModal(@item.StaffId)" 
                                            class="btn btn-sm btn-warning text-white rounded-pill px-3 me-1">
                                        Edit
                                    </button>
                                    <button onclick="confirmDelete(@item.StaffId, '@item.StaffName')" 
                                            class="btn btn-sm btn-danger rounded-pill px-3">
                                        Delete
                                    </button>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="dynamicModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content" id="modalContentContainer"></div>
    </div>
</div>

<div class="modal fade" id="deleteConfirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Xác nhận xóa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Bạn có chắc chắn muốn xóa nhân viên <strong id="deleteStaffName"></strong>?<br/>
            </div>
            <div class="modal-footer">
                <form asp-action="Delete" method="post">
                    <input type="hidden" name="id" id="deleteStaffId" />
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-danger">Xóa ngay</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function loadEditModal(id) {
            $.get('/Staff/GetEditPartial', { id: id }, function (response) {
                $('#modalContentContainer').html(response);
                $('#dynamicModal').modal('show');
            });
        }

        function confirmDelete(id, name) {
            $('#deleteStaffId').val(id);
            $('#deleteStaffName').text(name);
            $('#deleteConfirmModal').modal('show');
        }
    </script>
}