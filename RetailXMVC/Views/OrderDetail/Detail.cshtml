@model BusinessObject.Models.Order
@{
    Layout = "_SellerLayout";
    ViewData["Title"] = $"Đơn hàng #{Model.OrderId}";
    decimal grandTotal = 0; // Biến tích lũy tổng tiền
}

@* --- 1. CSS TÙY CHỈNH (Style Xám) --- *@
<style>
    :root {
        --gray-primary: #343a40;
        --gray-light: #f8f9fa;
        --gray-border: #e9ecef;
    }

    .card-modern {
        border: none;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        background: white;
        margin-bottom: 20px;
    }

    .info-label {
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
        color: #868e96;
        margin-bottom: 4px;
        letter-spacing: 0.5px;
    }

    .info-value {
        font-size: 1.1rem;
        font-weight: 600;
        color: #343a40;
    }

    /* Table Styles */
    .table-modern thead th {
        background-color: #f8f9fa;
        color: #495057;
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.8rem;
        border-bottom: 2px solid #dee2e6;
        padding: 12px 15px;
    }

    .table-modern tbody td {
        vertical-align: middle;
        padding: 12px 15px;
        color: #343a40;
        border-bottom: 1px solid #f1f3f5;
    }

    .btn-modern {
        border-radius: 6px;
        padding: 6px 16px;
        font-weight: 600;
        font-size: 0.85rem;
        border: none;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-block;
    }

        .btn-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

    .btn-dark-modern {
        background-color: #343a40;
        color: white;
    }

        .btn-dark-modern:hover {
            background-color: #212529;
            color: white;
        }

    .btn-outline-gray {
        background: white;
        border: 1px solid #ced4da;
        color: #495057;
    }

        .btn-outline-gray:hover {
            background: #f1f3f5;
            color: #212529;
        }

    .btn-action-edit {
        background: #e9ecef;
        color: #495057;
        padding: 4px 10px;
        font-size: 0.8rem;
    }

        .btn-action-edit:hover {
            background: #dee2e6;
            color: #212529;
        }

    .btn-action-delete {
        background: #fff5f5;
        color: #e03131;
        border: 1px solid #ffc9c9;
        padding: 4px 10px;
        font-size: 0.8rem;
    }

        .btn-action-delete:hover {
            background: #ffe3e3;
            color: #c92a2a;
        }
</style>

@* --- 2. HEADER & THÔNG TIN CHUNG --- *@
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold text-secondary m-0" style="letter-spacing: -0.5px;">Chi tiết đơn hàng</h2>
        <span class="text-muted small">Mã đơn: #@Model.OrderId</span>
    </div>
    <div class="text-end">
        <span class="badge bg-secondary fs-6 px-3 py-2">Ngày tạo: @Model.CreateDate.ToString("dd/MM/yyyy HH:mm")</span>
    </div>
</div>

<div class="card-modern p-4">
    <div class="row">
        <div class="col-md-6 border-end">
            <div class="info-label">Khách hàng</div>
            <div class="info-value">@(Model.Customer?.CustomerName ?? "Khách vãng lai")</div>
            @if (Model.Customer != null)
            {
                <div class="text-muted small mt-1">SĐT: @Model.Customer.Phone</div>
            }
        </div>
        <div class="col-md-6 ps-4">
            <div class="info-label">Nhân viên phụ trách</div>
            <div class="info-value">@(Model.Staff?.StaffName ?? "Unknown")</div>
            <div class="text-muted small mt-1">Role: @(Model.Staff?.Role.ToString() ?? "-")</div>
        </div>
    </div>
</div>

@* --- 3. DANH SÁCH SẢN PHẨM --- *@
<div class="card-modern">
    <div class="d-flex justify-content-between align-items-center px-4 py-3 border-bottom">
        <h5 class="m-0 fw-bold text-secondary">Danh sách sản phẩm</h5>

        @* Nút thêm sản phẩm *@
        <a asp-controller="OrderDetail" asp-action="Create" asp-route-orderId="@Model.OrderId"
           class="btn-modern btn-dark-modern btn-sm">
            + Thêm sản phẩm
        </a>
    </div>

    <div class="table-responsive">
        <table class="table table-modern mb-0">
            <thead>
                <tr>
                    <th>Sản phẩm</th>
                    <th class="text-center">Số lượng</th>
                    <th class="text-end">Đơn giá</th>
                    <th class="text-end">Thành tiền</th>
                    <th class="text-center" style="width: 150px;">Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.OrderDetails != null && Model.OrderDetails.Any())
                {
                    foreach (var d in Model.OrderDetails)
                    {
                        decimal unitPrice = d.Product?.Price ?? 0;
                        decimal lineTotal = d.Quantity * unitPrice;
                        grandTotal += lineTotal; // Cộng dồn tổng tiền

                        <tr>
                            <td>
                                <span class="fw-bold text-dark">@d.Product?.ProductName</span>
                            </td>
                            <td class="text-center">
                                <span class="badge bg-light text-dark border">x @d.Quantity</span>
                            </td>
                            <td class="text-end text-muted">
                                @unitPrice.ToString("N0")
                            </td>
                            <td class="text-end fw-bold text-dark">
                                @lineTotal.ToString("N0")
                            </td>
                            <td class="text-center">
                                <a asp-controller="OrderDetail" asp-action="Edit" asp-route-id="@d.OrderDetailId"
                                   class="btn-modern btn-action-edit me-1">Sửa</a>

                                <a asp-controller="OrderDetail" asp-action="Delete" asp-route-id="@d.OrderDetailId"
                                   class="btn-modern btn-action-delete"
                                   onclick="return confirm('Xóa sản phẩm này khỏi hóa đơn?');">Xóa</a>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="5" class="text-center py-5 text-muted">
                            Chưa có sản phẩm nào trong đơn hàng này.
                        </td>
                    </tr>
                }
            </tbody>

            @* --- FOOTER TỔNG TIỀN --- *@
            @if (Model.OrderDetails != null && Model.OrderDetails.Any())
            {
                <tfoot class="bg-light">
                    <tr>
                        <td colspan="3" class="text-end py-3">
                            <span class="text-uppercase fw-bold text-secondary me-2">Tổng cộng:</span>
                        </td>
                        <td class="text-end py-3">
                            <span class="fs-5 fw-bold text-dark">@grandTotal.ToString("N0") VNĐ</span>
                        </td>
                        <td></td>
                    </tr>
                </tfoot>
            }
        </table>
    </div>
</div>

@* --- 4. NÚT QUAY LẠI --- *@
<div class="text-end mt-4 mb-5">
    <a asp-controller="Orders" asp-action="Index" class="btn-modern btn-outline-gray px-4">
        Quay lại danh sách
    </a>
</div>